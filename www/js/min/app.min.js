"use strict";var controllers=angular.module("controllers",[]),app=angular.module("PuzzleApp",["controllers"]);app.factory("StorageService",function(){return{load:function(){var a=localStorage.getItem("saved_game");return a?JSON.parse(a):!1},save:function(a,b,c){localStorage.setItem("saved_game",JSON.stringify({moves:a,time:b,pieces:c}))},unsave:function(){localStorage.removeItem("saved_game")}}}),app.filter("timeFormat",["$filter",function(a){return function(a){var b,c;return b=Math.floor(a/60),c=a-60*b,b+" minutes, "+c+" seconds"}}]),controllers.controller("MainController",["$scope","$interval","StorageService",function(a,b,c){a.moves=0,a.timer=null,a.time=0,a.pieces=[],a.map=[{correctPosition:0,bgPosition:"left top"},{correctPosition:1,bgPosition:"center top"},{correctPosition:2,bgPosition:"right top"},{correctPosition:3,bgPosition:"left center"},{correctPosition:4,bgPosition:"center center"},{correctPosition:5,bgPosition:"right center"},{correctPosition:6,bgPosition:"left bottom"},{correctPosition:7,bgPosition:"center bottom"},{correctPosition:8,bgPosition:"right bottom"}],a.isSolved=function(){var b=!0;return angular.forEach(a.pieces,function(a){angular.element("#"+a.element).attr("data-position");a.correctPosition!=angular.element("#"+a.element).attr("data-position")&&(b=!1)}),b},a.newGame=function(){c.unsave(),a.init()},a.init=function(){var d=c.load();d?(a.pieces=d.pieces,a.moves=d.moves,a.time=d.time,angular.forEach(a.pieces,function(a){a.order=a.currentPosition})):(a.moves=0,a.time=0,a.pieces=[],angular.forEach(a.map,function(b){a.pieces.push({correctPosition:b.correctPosition,bgPosition:b.bgPosition,order:.5-Math.random(),element:b.bgPosition.split(" ")[0][0]+b.bgPosition.split(" ")[1][0]})})),angular.element("#puzzle-board").sortable({stop:function(d,e){a.$apply(angular.element(this).scope().moves++),$(".piece").each(function(){var b=$(this).attr("id"),c=$(this).index();angular.forEach(a.pieces,function(d){d.element==b&&(d.currentPosition=c),a.$apply(d.currentPosition)})}),c.save(a.moves,a.time,a.pieces),a.isSolved()&&(b.cancel(a.timer),c.unsave())}}),b.cancel(a.timer),a.timer=b(function(){a.time++,c.load()&&c.save(a.moves,a.time,a.pieces)},1e3)},a.init()}]);